<!DOCTYPE html>
<html>
<head>
  <title>iGUESS</title>
<link href="/assets/application.css?body=1" media="screen" rel="stylesheet" type="text/css" />
<link href="/assets/buttons.css?body=1" media="screen" rel="stylesheet" type="text/css" />
<link href="/assets/cities.css?body=1" media="screen" rel="stylesheet" type="text/css" />
<link href="/assets/datasets.css?body=1" media="screen" rel="stylesheet" type="text/css" />
<link href="/assets/home.css?body=1" media="screen" rel="stylesheet" type="text/css" />


<link href="/assets/mod_configs.css?body=1" media="screen" rel="stylesheet" type="text/css" />

<!--<link href="/assets/nav-bar.css?body=1" media="screen" rel="stylesheet" type="text/css" />
-->

<link href="/assets/text.css?body=1" media="screen" rel="stylesheet" type="text/css" />
<link href="/assets/tooltips.css?body=1" media="screen" rel="stylesheet" type="text/css" />

<script src="/assets/jquery.js?body=1" type="text/javascript"></script>
<script src="/assets/jquery_ujs.js?body=1" type="text/javascript"></script>
<script src="/assets/cities.js?body=1" type="text/javascript"></script>
<script src="/assets/datasets.js?body=1" type="text/javascript"></script>



<script src="/assets/mod_configs.js?body=1" type="text/javascript"></script>

<script src="/assets/application.js?body=1" type="text/javascript"></script>


  <meta content="authenticity_token" name="csrf-param" />
<meta content="yblXtqCrPmYg16+6DvLBquWBrenldVeWpGQi8ozD2II=" name="csrf-token" />  

 
<script type="text/javascript" src="http://weastflows.tudor.lu/spatiallib/ext-3.4.0/adapter/ext/ext-base.js"></script>
<script type="text/javascript" src="http://weastflows.tudor.lu/spatiallib/ext-3.4.0/ext-all.js"></script>

<link rel="stylesheet" type="text/css" href="http://weastflows.tudor.lu/spatiallib/ext-3.4.0/resources/css/ext-all.css" />
<link rel="stylesheet" type="text/css" href="http://weastflows.tudor.lu/spatiallib/ext-3.4.0/resources/css/xtheme-gray.css" />

<script type="text/javascript" src="http://weastflows.tudor.lu/spatiallib/OpenLayers-2.11/OpenLayers.js" ></script>

<link rel="stylesheet" type="text/css" href="http://weastflows.tudor.lu/spatiallib/OpenLayers-2.11/theme/default/style.css" />
 
 <style type="text/css">
 div.olControlMousePosition {
   background-color: #ffffff;
   font-size: smaller;
   font-weight: bold;
   opacity:0.7;
 }
 </style> 
 
   <script type="text/javascript">
  /* Script to enable JQuery UI / Themeroller buttons */
  /* http://www.filamentgroup.com/lab/styling_buttons_and_toolbars_with_the_jquery_ui_css_framework/ */
              /*$(document).ready(function(){
                  //hover states on the static widgets
                  $(".button_to").hover(
                      function() { $(this).addClass('ui-state-hover'); },
                      function() { $(this).removeClass('ui-state-hover'); }
                  );

              });*/
</script> 
 

 
<script type="text/javascript">
 
 var mapProjection = "EPSG:28992";
 
 // Avoid pink error tiles
 OpenLayers.IMAGE_RELOAD_ATTEMPTS = 3;
 OpenLayers.Util.onImageLoadErrorColor = "transparent";
 
 var buildsGML;
 
//create a style object
var style = new OpenLayers.Style();
//rule used for all polygons
var rule_fsa = new OpenLayers.Rule({
	symbolizer: {
		fillColor: "#DDDD00",
		fillOpacity: 0.6,
		strokeColor: "#DDDD00",
		strokeWidth: 1,
	}
});

var rule_highlight = new OpenLayers.Rule({
	filter: new OpenLayers.Filter.Comparison({
		type: OpenLayers.Filter.Comparison.GREATER_THAN,
		property: "cat",
		value: 1000,
	}),
	symbolizer: {
		fillColor: "#FF7144",
		fillOpacity: 0.5,
		strokeColor: "#FF7144",
		strokeWidth: 2,
		strokeDashstyle: "solid",
	}
});

style.addRules([rule_fsa, rule_highlight]);

var winPanel = new Ext.Window({
	title: 'Potential Application', //Title of the Window 
	id: 'panelWindowId', //ID of the Window Panel
	autoHeight: true, //Height of the Window will be auto
	width:300, //Width of the Window
	resizable: false, //Resize of the Window, if false - it cannot be resized
	closable: false, //Hide close button of the Window
	modal: false, //When modal:true it make the window modal and mask everything behind it when displayed
	contentEl: 'divWindowId' //ID of the respective 'div'
	});

function initMap(){
	
	var bounds = new OpenLayers.Bounds(91979, 436326, 92617, 437659.5);

	map = new OpenLayers.Map("MiniMap",{
		projection: new OpenLayers.Projection(mapProjection),
		units: "m",
		maxExtent: bounds,
	});
	
	map.addControl(new OpenLayers.Control.LayerSwitcher());
	
	var streets =  new OpenLayers.Layer.WMS(
    	"Streets",
    	"http://weastflows.tudor.lu/cgi-bin/mapserv?map=/var/www/MapFiles/Rotterdam02.map",
        {layers: "Streets", 
         format: "image/png",
         srsName: mapProjection,
	 	 transparent: "true",
     	 projection: new OpenLayers.Projection(mapProjection)},
        {isBaseLayer: true,  
     	 visibility: true}
    );
       
    buildsGML = new OpenLayers.Layer.Vector("BuildingsGML", {
        protocol: new OpenLayers.Protocol.HTTP({
            url: "assets/BuildingsFull.gml",
            format: new OpenLayers.Format.GML()
        }),
        styleMap: style,
        strategies: [new OpenLayers.Strategy.Fixed()]
    });

	map.addLayers([streets, buildsGML]);

}

var tipSlider;
var potSlider, capSlider, invSlider;

Ext.onReady(function(){
	
   
    potSlider = new Ext.Slider({
        renderTo: 'slider-potential',
        width: 214,
        value: 0,
        minValue: 0,
        maxValue: 1000,
        plugins: new Ext.ux.SliderTip()
    });
    
    invSlider = new Ext.Slider({
        renderTo: 'slider-investment',
        width: 214,
        value: 0,
        minValue: 0,
        maxValue: 6000,
        plugins: new Ext.ux.SliderTip()
    });
    
    capSlider = new Ext.Slider({
        renderTo: 'slider-capacity',
        width: 214,
        value: 0,
        minValue: 0,
        maxValue: 10000,
        plugins: new Ext.ux.SliderTip()
    });
    
	potSlider.on('change', potDragged, this);
	capSlider.on('change', capDragged, this);
	invSlider.on('change', invDragged, this);
	
});

var lock = false;

function potDragged(ed, value, oldValue) {
	
	newSliderValues(potSlider.thumbs[0].value / 10);
}

function invDragged(ed, value, oldValue) {
	
	newSliderValues((invSlider.getValue() + 0.0) / (invSlider.maxValue + 0.0) * 100);
}

function capDragged(ed, value, oldValue) {
	
	newSliderValues((capSlider.getValue() + 0.0) / (capSlider.maxValue + 0.0) * 100);
}

function newSliderValues(percent) {
	
	if(!lock)
	{
		// Since the browser is single threaded this is safe.
		lock = true;
		percent = parseInt(percent);
		
		document.getElementById("percent").innerHTML  = "Potencial: "  + percent + " %";
		document.getElementById("invest").innerHTML   = "Investment: " + percent * invSlider.maxValue / 100 + " k&euro;";
		document.getElementById("capacity").innerHTML = "Capacity: "   + percent * capSlider.maxValue / 100 + " kWp";
		
		invSlider.setValue(percent * invSlider.maxValue / 100);
		capSlider.setValue(percent * capSlider.maxValue / 100);
		potSlider.setValue(percent * potSlider.maxValue / 100);
		
		rule_highlight.filter.value = 1000 - potSlider.getValue();
		buildsGML.redraw();
		lock = false;
	}
}

function showWindow() {
	
	winPanel.show();
}
 
</script>
</head>
 <body onLoad="initMap();" style="margin:0px">
 	
 	<div id="top_banner">
  <div style="float:left; margin-top:1.3em; margin-left: .7em;">
    <a href="http://www.tudor.lu/"><img alt="Henri Tudor Institute" border="0" height="35" src="/assets/tudor_logo.png" width="99" /></a>
  </div>   
        
  <div style="float:right; margin-top:.6em; margin-right: .7em;">
    <a href="http://themusicproject.eu"><img alt="MUSIC Project" border="1" src="/assets/music_logo.png" /></a>&nbsp;
    <a href="http://www.nweurope.eu/"><img alt="INTERREG IVB" border="0" src="/assets/interreg_logo.png" /></a>
  </div>  
  
  <div style="text-align:center;">                                 
    <div style="font-size: 300%; margin-bottom:-.35em">iGUESS</div>
    <div style="padding-bottom: .5em">integrated Geospatial Urban Energy information and Support System</div>
  </div> 
  
  <div id="navbar">
    <ul id="nav">
      <li id="nav-1" title="<u><b>Return to starting screen</b></u>">
          <a href="/">Home</a></li>
      <li id="nav-1" title="<u><b>Manage data</b></u><br>Upload new data, and view existing datasets">
          <a href="/datasets">Data Manager</a></li>   
      <li id="nav-2" title="<u><b>Configure and run modules</b></u><br>Modules create new datasets by running calculations">
          <a href="/mod_configs">Modules</a></li>
      <li id="nav-3" title="<u><b>Define and run scenarios</b></u><br>Scnarios are complex models of potential future situations">
          <a href="scenarios.htm">Scenarios</a></li>
      <li id="nav-4" title="<u><b>Decision support tools</b></u><br>Compare scenario results, and access related tools">
          <a href="decision_support.htm">Decision Support</a></li>
      <li id="nav-5" title="<u><b>View maps</b></u><br>Visualize data and model results">
          <a href="/maps">Maps</a></li> 
      <li id="nav-6" title="<u><b>About</b></u><br>About this site and contact details">
          <a href="/about">About</a></li> 
    
      <div id="xx">
      <select name="cities" id="city-dropdown" onchange="frames['map'].location.href = this.value">
          <option value="http://www.openstreetmap.org/?lat=57.1437&amp;lon=-2.0982&amp;zoom=12&amp;layers=M">Aberdeen</option>
          <option value="http://www.openstreetmap.org/?lat=51.0499&amp;lon=3.7166&amp;zoom=12&amp;layers=M">Ghent</option>
          <option value="http://www.openstreetmap.org/?lat=48.8867&amp;lon=9.1955&amp;zoom=12&amp;layers=M">Ludwigsburg</option>
          <option value="http://www.openstreetmap.org/?lat=48.8642&amp;lon=2.4432&amp;zoom=12&amp;layers=M">Montreuil</option>
          <option value="http://www.openstreetmap.org/?lat=51.9225&amp;lon=4.4792&amp;zoom=12&amp;layers=M">Rotterdam</option>
      </select>
      
      <div id="login"><a href="#" onclick="alert('Logins not implemented yet!!')">[Login]</a></div>
      </div>
    </ul>
          

  </div>
</div>
 	
 	<p id="par">
 		<!--If you don't see any data after loading, please zoom in.-->
 		</p>
 	<div  style="width:100%; height:700px; background:white" id="MiniMap"></div>
 	<br/>
	<a href=# onClick="showWindow();">Show window</a>
	
	<div title="divWindowId" id="divWindowId" class="x-hidden" style="padding:10px">
	<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam a vestibulum sem. In a elit ipsum, at cursus enim. Nullam non dui tellus, vitae vestibulum tortor. Aliquam gravida tellus lorem, quis consectetur quam. Donec mollis auctor nunc eget scelerisque.</p>
	<p>Vivamus dignissim diam in ligula semper vestibulum. Aenean luctus nisi in metus ultrices eu congue odio sodales. Aenean volutpat viverra est, at feugiat libero commodo ut. Maecenas at quam eget libero feugiat ullamcorper quis placerat ligula. Aliquam et tortor vitae enim viverra faucibus.</p>
	<br>
	<br>
	<h4 id="percent">Potencial: 0 %</h4>
	<div id="slider-potential"></div>
	<br>
	<br>
	<h4 id="capacity">Capacity: 0 kWp</h4>
	<div id="slider-capacity"></div>
	<br>
	<br>
	<h4 id="invest">Investment: 0 k&euro;</h4>
	<div id="slider-investment"></div>
	<br>
	<br>
	<input type="button" value="Close" onClick="winPanel.hide();"/>
	<br/>
	</div>
	
 </body>
</html>



